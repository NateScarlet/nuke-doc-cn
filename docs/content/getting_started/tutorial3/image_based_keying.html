<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Tutorials|Written Tutorials|Keying and Mattes">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Image-Based Keying</title>
        <link href="../../../skins/default/stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../skins/default/stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../skins/default/stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../skins/default/stylesheets/components/styles.css" rel="stylesheet" />
        <link href="../../../skins/default/stylesheets/components/tablet.css" rel="stylesheet" />
        <link href="../../../skins/default/stylesheets/components/mobile.css" rel="stylesheet" />
        <link href="../../assets/stylesheets/nuke_stylesheet.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
        <script src="../../assets/stylesheets/load.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../Default.html#getting_started/tutorial3/image_based_keying.html">Open topic with navigation</a>
        </p>
        <script>/* <![CDATA[ */
			$(document).ready(function(){ 
			$('.dropDownMiniTOCmenu:not(:has([class*="MCMiniTocBox"]))').remove();
			});
		/* ]]> */</script>
        <div class="nocontent">
            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
            </div>
        </div>
        <h1>Image-Based Keying</h1>
        <p class="afterHead">Many keying tools, like Primatte, use a color-pick as the baseline for the matte extraction process and then require the artist to tweak the matte from that baseline. <span class="CustomProduct">Nuke</span>’s image-based keyer (IBK) uses the pixel values of the compositing images, instead of a color-pick, to generate the best matte for the image you want to extract. It works by generating a processed screen image that preserves the color variations of the blue- or greenscreen and using this - rather than a single color - to pull the key. This generally gives good results and speeds up the keying process when working with uneven blue- or greenscreens.</p>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk1.png" />
        </p>
        <p>Image-based keying requires two nodes in <span class="CustomProduct">Nuke</span>. First, you insert an IBKColour node to process the screen image, which is preset to work with either greenscreen or bluescreen. This node generates the processed screen image that preserves the color variations in your blue- or greenscreen. Then, you insert an IBKGizmo node to generate the matte using the processed screen image, the original image, and also the background image for the composite. </p>
        <h3>To Pull a Key with IBK</h3>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>1. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="1. &#160;">In the <b>keying_tutor.nk</b> project file, locate the node tree labeled, “<b>Image-based Keying</b>”. </td>
            </tr>
        </table>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>2. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="2. &#160;">Right-click over the <b>Reformat3</b> node and choose <b>Keyer</b> &gt; <b>IBKColour</b>. Drag the <b>IBKColourV3_1</b> node to the right.</td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk2.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>3. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="3. &#160;">Click an empty spot in the Node Graph to deselect all nodes. Then, right-click and choose <b>Keyer</b> &gt; <b>IBKGizmo</b>. </td>
            </tr>
        </table>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>4. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="4. &#160;">From <b>IBKGizmoV3_01</b> node, connect <b>fg</b> (foreground) to the <b>Reformat3</b> node. Connect <b>c</b> (color screen) to the <b>IBKColourV3_1</b> node. </td>
            </tr>
        </table>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>5. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="5. &#160;">Connect <b>bg</b> from <b>IBKGizmoV3_1</b> to the <b>Reformat4</b> node, which supplies the background for the comp. </td>
            </tr>
        </table>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>6. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="6. &#160;">Connect the Viewer to the <b>IBKGizmoV3_1</b> node, and your node tree should look similar to this:</td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk3.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>7. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="7. &#160;">Open the control panel for <b>IBKColourV3_1</b> and change the <b>screen type</b> to <b>green</b>. </td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk4.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>8. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="8. &#160;">Open the control panel for <b>IBKGizmoV3_1</b>, and change its <b>screen type</b> to <b>C-green</b>. </td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk5.png" />
        </p>
        <p class="numberedCont">You should see an acceptable matte, shown in the screen capture below, on frame 50.</p>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk6.png" />
        </p>
        <p class="numberedCont">This is a very good start for this image. </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>9. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="9. &#160;">Connect the Viewer to the <b>IBKColourV3_1</b> node. You’ll see the processed screen image, which is essentially a Gaussian-filtered high-contrast key.</td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk7.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>10. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="10. &#160;">Choose <b>Merge</b> &gt; <b>Merge</b> (or press <b>M</b> over the Node Graph) to insert a <b>Merge (over)</b> node. </td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk8.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>11. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="11. &#160;">Connect <b>IBKGizmoV3_1</b> to the <b>A</b> input of the <b>Merge (over)</b> node. Then connect the <b>B</b> input to the <b>Reformat4</b> node. </td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk9.png" />
        </p>
        <p class="numberedCont">The color of this greenscreen is completely out of the region of the acceptable industry standard, but IBK does a good job anyway, by smoothing the screen and using the result to essentially create a difference matte with the foreground.</p>
        <p class="tip" data-mc-autonum="&lt;span style=&quot;color: Black;&quot; class=&quot;mcFormatColor&quot;&gt;TIP:&lt;/span&gt; &#160;"><span class="autonumber"><span><span style="color: Black;" class="mcFormatColor">TIP:</span> &#160;</span></span>IBK has presets for green and blue screens, but you can also do a color-pick for any screen color inside the IBKGizmo node.</p>
        <p class="numberedCont">If you zoom-in on the image, you’ll see small areas near the subject’s hair, where the matte is compromised.</p>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk10.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>12. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="12. &#160;">Connect the Viewer to <b>IBKColourV3_1</b> and you’ll see color artifacts around the edges of the matte. </td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk11.png" />
        </p>
        <p class="numberedCont">When you look at the smoothed screen produced by IBKColour, you should see only values of your screen color and black. </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>13. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="13. &#160;">In the <b>IBKColourV3_1</b> control panel, lower the <b>darks</b>, <b>g</b> (green) setting to <b>-0.08</b>. (If you were keying a bluescreen image, you would lower the “b” value for “darks.”).</td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk12.png" />
        </p>
        <p class="numberedCont">This fixes most of the problems at the hairline, but destroys the good key for the lower portion of the image.</p>
        <p class="tip" data-mc-autonum="&lt;span style=&quot;color: Black;&quot; class=&quot;mcFormatColor&quot;&gt;TIP:&lt;/span&gt; &#160;"><span class="autonumber"><span><span style="color: Black;" class="mcFormatColor">TIP:</span> &#160;</span></span>The artifacts in the IBKColour image appear as specific color shades: light green, dark green, light red, dark red, light blue, and dark blue. To remove these, simply adjust the appropriate controls for the artifacts you want to remove: lights/g, darks/g, lights/r, darks/r, lights/b, and darks/b.</p>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk13.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>14. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="14. &#160;">In <b>IBKColourV3_1</b>, raise the <b>darks</b>, <b>g</b> value to <b>-0.03</b>. Then change the <b>lights</b>, <b>g</b> value to <b>0.75</b>. This corrects the artifacts of the screen image.</td>
            </tr>
        </table>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>15. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="15. &#160;">Now, change the <b>patch black</b> setting to <b>1.5</b> to restore the edge detail of the hairline.</td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk14.png" />
        </p>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk15.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>16. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="16. &#160;">Connect the Viewer to the <b>IBKGizmoV3_1</b> node. Press <b>A</b> and you’ll see the current alpha channel produced by the IBK system. </td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk16.png" />
        </p>
        <p class="numberedCont">The displayed alpha image shown is correct for the IBK. If the intensity of the noise in your alpha channel is greater than the example show above, you may need to adjust - in very small increments - the <b>dark</b> and <b>light</b> values for the color channels in the IBKColour node.</p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>17. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="17. &#160;">Press <b>A</b> again over the Viewer to toggle back to display all color channels, and scrub through the timeline to check the matte at various points in the clip.</td>
            </tr>
        </table>
        <p class="graphic">
            <img src="../../assets/images/gsg_images/ibk17.png" />
        </p>
        <table class="AutoNumber_p_numbered1" style="width: 100%; margin-left: 0;" cellspacing="0" cellpadding="0">
            <col style="width: 0px;" />
            <col style="width: 25px;" />
            <col style="width: auto;" />
            <tr>
                <td valign="top" />
                <td class="AutoNumber_p_numbered1" valign="top"><span>18. &#160;</span>
                </td>
                <td class="AutoNumber_p_numbered1" valign="top" data-mc-autonum="18. &#160;">If you haven’t already done so, save your project under a new file name to save the changes you’ve made to project. </td>
            </tr>
        </table>
        <table style="width: 100%;border-bottom-style: solid;border-bottom-width: 1px;">
            <col />
            <tbody>
                <tr>
                    <td>
                        <p>&#160;</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="MCDropDown MCDropDown_Open dropDown dropDownMiniTOCmenu"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCDropDownHotSpot_MiniTOCmenu MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../skins/default/stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Topics In This Section</a></span>
            <div class="MCDropDownBody dropDownBody">
            </div>
        </div>
    </body>
    <script type="text/javascript">/* <![CDATA[ */
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-60569477-1', {'cookieDomain': 'none'});
	/* ]]> */</script>
    <script type="text/javascript">/* <![CDATA[ */
		$("document").ready(function ()
		{
		function postMe()
		{
		var cust = document.getElementById("search-field").value;
		console.log(cust);
		ga('send', 'event', "Nuke", "search", cust, 9);
		}
		var submitButton = $(".search-submit");
		submitButton.click(function() { postMe(); return true; } );
		var submit = $("input#search-field");
		submit.keypress(function(e) { if(e.keyCode==13) { postMe(); } return true; } );
		});
	/* ]]> */</script>
</html>